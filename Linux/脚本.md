<h1>脚本</h1>


##   声明变量

变量在Linux脚本中非常常见。

声明变量很简单，只需要使用等号将变量名和变量值连接起来即可：
```
a=1
str=hello
echo $a
echo $str
```

如果值有空格，则需要使用引号：

```sh
str ="hello bash"
```
要特别注意，等号两边不能有空格，下面的命令是错的：
```
a  =  1
bash: a: command not found
```

bash会把a当做命令、= 和1当做参数去执行。

## 打印变量

使用echo加上美元符号$和花括号打印变量：
```
echo $PATH
echo ${PATH}
```
如果变量名称不存在空格和特殊字符，上面两种方式都可以。如果存在空格或特殊字符，变量名称就要用花括号括起来。

## 字符串转义

有些时候我们恰好需要用到特殊字符本来的含义，例如：

```sh
echo "coffee is $five"
```

这里会找到名为five的变量解析出来，但我们的本意是只想显示“咖啡是5美元”，所以使用转义：

```sh
echo "coffee is \$five"
```

这样就输出了“coffee is $five”。


##  变量内容的编辑

- `${变量#关键词}`  若变量内容从头开始的数据符合关键词，则将符合的最短数据删除
- `${变量##关键词}`  若变量内容从头开始的数据符合关键词，则将符合的最长数据删除
- `{变量%关键词}`  若变量内容从尾向前的数据符合关键词，则将符合的最短数据删除
- `{变量%%关键词}`  若变量内容从尾向前的数据符合关键词，则将符合的最长数据删除
- `{变量/旧字符串/新字符串}` 若变量内容符合旧字符串，则第一个旧字符串会被新字符串替换
- `{变量//旧字符串/新字符串}` 若变量内容符合旧字符串，则全部的旧字符串会被新字符串替换

示例：

```
str="hello,hello,world"
echo ${str#h*o} # 输出 ,hello,world
echo ${str##h*o}  # 输出 rld

echo ${str/hello/HELLO} # 输出 HELLO,hello,world
echo ${str//hello/HELLO} # 输出 HELLO,HELLO,world
```


## 几种特殊的内容替换结构

```
${var:-string} 
${var:+string} 
${var:=string}
${var:?string}
```

1、${var:-string}和${var:=string}:若变量var为空，则用在命令行中用string来替换${var:-string}，否则变量var不为空时，则用变量var的值来替换${var:-string}；对于${var:=string}的替换规则和${var:-string}是一样的，所不同之处是${var:=string}若var为空时，用string替换${var:=string}的同时，把string赋给变量var： ${var:=string}很常用的一种用法是，判断某个变量是否赋值，没有的话则给它赋上一个默认值。

2、${var:+string}的替换规则和上面的相反，即只有当var不是空的时候才替换成string，若var为空时则不替换或者说是替换成变量 var的值，即空值。(因为变量var此时为空，所以这两种说法是等价的)

3、{var:?string}替换规则为：若变量var不为空，则用变量var的值来替换${var:?string}；若变量var为空，则把string输出到标准错误中，并从脚本中退出。我们可利用此特性来检查是否设置了变量的值。

补充扩展：在上面这五种替换结构中string不一定是常值的，可用另外一个变量的值或是一种命令的输出。


## shell脚本的参数

新建一个Shell脚本1.sh内容如下：
```
echo  $1
```

$1表示该脚本的第一个参数，类似的 $2 、$3表示第2、3个参数，以此类推。

然后运行：
```sh
$  ./test.sh  hello
hello
```

另外，$*引用所有参数列表。$#：表示执行脚本传入参数的所有个数



##  条件表达式

在脚本中经常会用到条件表达式，条件表达式常用在if语句中，用中括号包裹，各个部分用空格隔开，例如：

```
if [ 2 -eq 3 ] then 
        echo 相等
fi
```

条件表达式中最常见的情况是比较，比较常用的比较是数值比较和字符串比较。

## 数值比较

与数学公式不同，数值比较需要用到-gt、-lt、-eq表示大于、小于、等于号，而不能是>、<、=。

|比较运算符	|	解释	|	示例|
|---	|	---	|	---|
-eq 	|	相等 	|	[    1  -eq  2   ]
-ne		|	不等于	|	[   1  ne  2     ]
-ge		|	大于等于	|	[   1  -eq   2    ]
-gt	|	大于	|	[   2   -gt   1   ]
-le		|	小于等于	|	[   1  -le  2  ]
-lt		|	小于	|	[  1  -le  2   ]

表格示例中空格间距比较大，就是为了题型注意各个部分一定要加上空格。

## 字符串比较

字符串的比较方式是根据ASCII逐个字母比较，常用的字符串比较运算符如下：

| 比较运算符 | 含义  | 示例  |
| ----- | --- | --- |
=	|	 相同	|	[   'a'   = 'a'  ]
!=	|	不同	|	[  'a'   != 'b'  ]
<	|	小于	|	[  'a'   <  'A'  ]
>	|	大于	|	[  'a'   > 'A'  ]
-n str 	|	字符串str长度是否非0	|	[   -n  'a' ]
-z str 		|	字符串str长度是否为0	|	[   -z  '' ]


## 文件判断

文件判断常用的运算符如下表：

|运算符	|	解释|
|---	|	---|
-d file	|	判断file是否为目录
-e file	|	判断file是否存在
-f file	|	检查file是否为文件
-r file	|	判断文件是否可读
-s file	|	判断file是否存在并非空
-w file	|	判断file是可写
-x file	|	判断file是可执行


##   if语句

if语句的作用是根据条件执行不同的指令。if语句的通用语法如下：

```
if [ 条件表达式 ]; then
    指令
```

注意条件表达式各个部分都要有空格，例如：

```
if [ 2 -gt 1 ] then 
        echo 大于 
fi
```

单分支就是只有一个分支，如同上面的示例。

双分支有一个if和一个else，例如：

```
if [ 2 -eq 3 ]  then 
        echo 相等
else 
        echo 不相等
fi
```

多分支有一个以上的elif，例如如下脚本1.sh：

```
if [ $1 -ge 80 ] then 
        echo 优秀
elif [ $1 -ge 60 ] then 
        echo 及格
else 
        echo 不及格
fi
```

这里$1表示传入脚本的第一个参数，运行如下示例：

```
$ bash  1.sh 88
优秀
$ bash  1.sh 76
及格
$ bash  1.sh 50
不及格
```


##  for循环

for循环的基本语法格式如下：

```
for item in con1 con2 con3
do
    命令
done
```

遍历文件

```sh
i=0
filelist=$(ls) # 当前目录所有文件
for filename in ${filelist}
do
    i=i+1
    echo "第${i}个文件是：${filename}"
done
```


还有一种写法

```sh
for (( 初始值; 限制条件; 赋值))
do
    程序段
done
```

示例

```sh
for (( i=1; i<=5; i=i+1 ))
do
    touch "file${i}.txt"
done
```



## 函数

### 创建函数

使用关键字:

```
function 函数名 {
    函数体
}
```

第二种方式是不使用function关键字,但要带上括号,

```
函数名(){
    函数体
}
```


### 调用函数

要使用函数,直接写上函数名即可,不要带括号。

一个具体的示例如下:

```
function Welcome {
    read -p "你的名字:" name
    echo "你好,${name}" 
}

Welcome
```

### 带参数的函数

与脚本的参数一样，函数的参数不需要指定名称，而是使用$1 、$2指代。

```
function Welcome{
  echo "你好，$1"
}

Welcome 张三  #输出：你好，张三
```


### 函数的返回值

函数使用echo返回值，这与常用的return习惯不太一样。注意，echo在函数体外是向终端输出内容，但在这里表示返回值，也就是说，分两种情况：
- 如果有一个变量接住这个函数，此echo就失去了原有的作用——也就不会在终端输出值。
- 如果没有变量接住这个函数，那么echo就会在终端输出。

```
function Welcome {
    echo "你好，$1"  # 此时不会在终端输出
}

out=$(Welcome)  # 变量接住了，没有输出

Welcome 张三  # 没有变量接住，输出 你好，张三
```




## 数组

如果已经知道数组元素，使用如下方式新建数组：

```
arr=(1 2 three four)
```

空格分隔的每个部分都对应一个元素，如下示例按索引位置打印元素：

```
echo ${arr[0]}  ${arr[3]}
1 four
```

##  给脚本传递参数

- `$0` 第0个参数，即执行文件本身
- `$1` 第1个参数
- `$n` 第n个参数, n是正整数
- 注意, 如果参数过多, 达到了两位数,那么就要加花括号,例如 ${10}
- `$#`  表示脚本运行时携带的命令行参数的个数
- `$*`变量会将所有的命令行参数视为一个单词, 该选项不常用
- `$@`变量会将所有的命令行参数视为同一字符串中的多个独立的单词，以便你能通过for循环遍历,

新建一个Shell脚本test.sh内容如下：
```
echo  "第0个参数也就是脚本名称是：$0"
echo  "第1个参数是：$1"
echo  "第2个参数是：$2"
echo  "参数个数为: $#"
echo  "参数列表为: $@"
```

$1表示该脚本的第一个参数，类似的 $2 、$3表示第2、3个参数，以此类推。

然后运行：
```sh
$  ./test.sh  hello bash shell
```

输出如下结果:

```
第0个参数也就是脚本名称是：test.txt
第1个参数是：hello
第2个参数是：bash
参数个数为: 3
参数列表为: hello bash shell
```
