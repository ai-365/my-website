<p id="top" style="font-size:36px;font-weight:bolder;">SD</p>

<a style="position: fixed;top:100px;left:-20px;" href="#top">回到顶部</a>

- [Stable Diffusion](#stable-diffusion)
  - [SD的发布时间](#sd的发布时间)
  - [SDXL简介](#sdxl简介)
  - [SD的主要原理](#sd的主要原理)
  - [从 U-Net 到Transformer](#从-u-net-到transformer)
  - [隐空间的作用](#隐空间的作用)
  - [SD应用的主要文件夹](#sd应用的主要文件夹)
- [LoRA训练](#lora训练)
  - [repeat、epoch、batch\_size的区别](#repeatepochbatch_size的区别)
  - [学习率](#学习率)
  - [打tag](#打tag)
- [提示词](#提示词)
  - [增大或减小权重的语法](#增大或减小权重的语法)
  - [组合语法](#组合语法)
  - [隔离语法](#隔离语法)
  - [过渡语法](#过渡语法)
  - [交替词语法](#交替词语法)


##  Stable Diffusion

###  SD的发布时间

1.0发布于2022年9月，2.0发布于2022年11月，3.0发布于2024年5月。

### SDXL简介

SDXL 就是 SD 的升级版，图片生成的效果更好、更逼真、分辨率更高。

### SD的主要原理

将输入（文本或图片）向量化 ——>    通过VAE压缩到Latent隐空间 ——>  在隐空间中多次去噪 ——> 通过VAE解码还原到像素空间

###   从 U-Net 到Transformer 

由于自注意力的可扩展性、强大的性能，扩散模型背后的骨干网络，已经由U-Net替换成了Transformer架构。Transformer 已然完成了深度学习领域的大一统。

### 隐空间的作用

隐空间通俗来说将图片数据量压缩，这样便于提升训练和推理的性能。类似于视频帧的压缩。

###  SD应用的主要文件夹

重点关注几个文件夹： checkpoint 大模型文件夹 、 embeddings 向量化、Lora微调、VAE变分自编码器、 ControlNet插件、Custom Nodes 自定义节点



## LoRA训练

###   repeat、epoch、batch_size的区别

![repeat、epoch、batch_size](img/repeat、epoch、batch_size.png)

名词 | 解释
|---|---|


###  学习率 

学习率类似于车速。学习率过高，学的太快，囫囵吞枣，可能会过拟合。学习率太低，可以更好看清路上的风景，也就是AI可以更细致的去学习，但是可能会导致不拟合，也就是出图完全不像，学的太慢了，并且花费的时间更多。

学习率默认值1e-4，即0.0001。


###  打tag

**如果是希望灵活调整的特征，都必须把tag打清楚**。如果是固化在模型里面的特征，都不要去打tag。例如，如果希望头发颜色可以自定义，则必须写明 red hair ，如果不写明，将来AI会认为“人类的头发就是红色的”，将来所有生成的图片都将是红色头发。


##  提示词

###  增大或减小权重的语法

权重语法使用括号包裹。(a:n)中，a为提示词，n为权重，n大于1则增加权重，n小于1则减少权重。一般n取0.3到1.5之间。

在权重语法中，除了直接指明权重，还可以使用多个括号。圆括号()和花括号表示加权，中括号`[]`表示降权。(a)单个圆括号表示提升1.1倍权重，((a))双圆括号表示权重为1.1 * 1.1，即1.21 。而`[a]`双中括号表示将权重降低1.1倍。

注意，使用了多个圆括号、方括号、花括号，就不能指定权重值了，这样会有歧义，例如降权不能写成` [a:0.8] `，这是指定迭代步骤的意思。所以，为了简洁明了，推荐使用使用圆括号加直接声明权重值的方式。

SD权重语法汇总如下：

语法	|	说明
---	|	---
`关键词`	|	没有任何符号，默认情况，1倍的权重
`(关键词)`	|	1.1倍的权重
`((关键词))`	|	1.21倍的权重
`(关键词: x)`	|	x倍的权重，x最好控制在0.5~1.5之间
`[关键词A and 关键词B]`	|	关键词A和关键词B的混合，例如`[hot and dog]`表示在火中的狗
`[关键词A_关键词B]`	|	组合成的新词，例如`[hot_dog]`表示热狗，跟hot和dog均没有关系
`[关键词:0.8]`	|	在80%时刻才开始生成关键词，前面的时间跟该关键词无关
`[关键词::0.8]`	|	前80%时间段生成关键词，后面的时间跟该关键词无关
`[关键词A:关键词B:0.8]`	|	前80%的时间渲染关键词A，后20%的时间渲染关键词B
`[关键词A\|关键词B] `	|	关键词A和关键词B交替绘制，例如`[tiger|cat]`最后能生成一种虎猫兽

### 组合语法

组合语法有两种。`[A_B] `、`[A and B]`。

`[A_B] `。在提示词和提示词之间加一条下划线,可以让两个词语组合成一个词语。

`[A and B]`。and是把两个词融合在一起。

一个示例可以很直接的区分这两种用法：
-  ` [hot and dog] `，就会生成在火中的狗。
- ` [hot_dog] `，就会生成热狗。热狗跟狗没关系。



### 隔离语法

在两个提示词中间写上“break”，作用就是把两个词完全隔离开。

例如，AI很容易记混颜色描述： 1girl,Silver hair,Black blouses,Gray pants。银色头发、黑上衣、灰背带裤的女孩。生成的图片很可能会出错，变成 黑头发，白上衣，银裤子
在加上break后，1girl,silver hair break Black blouses break Gray pants 后，AI的准确率就提高了。

###  过渡语法

过渡语法混合两个迭代时机，使用双括号加一个数值，数值表示从哪个时机才开始渲染。`[cloud:0.8]`代表在80%的时间才开始渲染云。



`[cloud::0.8]`代表前80%的时间渲染云，后20%的时间跟云无关。



`[city:tree:0.8]`代表前80%的时间渲染城市，后20%的时间渲染树。



### 交替词语法

`[cat|tiger]`代表cat和tiger交替绘制，最后能生成虎猫兽。

[ cloud :: 0.8  ]

    

这段时间渲染云

这段时间干别的事
